<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail Formation</title>
    <link rel="stylesheet" href="../header_footer/header_footer.css" />
    <!-- importation bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="formation.css" />
  </head>

  <body>
    <!-- ========== Start header ========== -->

    <nav class="navbar navbar-expand-lg px-lg-5" id="nav">
      <div class="container-fluid">
        <a class="navbar-brand" href="#"
          ><img src="../header_footer/assets/logo.png" alt=""
        /></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
          id="menu-burger"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="../index.html" id="link-actv"
                >Accueil</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../page_a_propos/a_propos .html" id="link-actv">A propos</a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                aria-current="page"
                href="formation.html"
                id="link-actv"
                >Formations</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="link-actv">Articles</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                id="link-actv"
              >
                Politiques
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Confidentialité</a></li>
                <li><a class="dropdown-item" href="#">D'utlisation</a></li>
                <!-- <li><hr class="dropdown-divider"></li> -->
                <li><a class="dropdown-item" href="#">Cookies</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="link-actv">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="separation"></div>
    <!-- ========== End header ========== -->
    <div class="banniere">
      <img
        src="https://images.unsplash.com/photo-1532012197267-da84d127e765?auto=format&fit=crop&q=80&w=1374&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        class="img-fluid"
        alt=""
      />
    </div>

    <div class="f-title">
      <h4>La formation en <span id="formation-title">PHP</span></h4>
    </div>

    <div class="fdetail mt-5">
      <div class="row">
        <div class="col-lg-4 m-auto p-0">
          <div class="allvideos" id="allvideos">
            <h4>VIDEOS</h4>
          </div>
        </div>
        <div class="col-lg-7 m-auto p-0">
          <div class="displayvideo" id="displayvideo">
            <iframe
              width="100%"
              height="100%"
              src="https://www.youtube.com/embed/mr3E8TveNJU?si=TgZnYDtH1HLLSztP"
              title="YouTube video player"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
            ></iframe>
          </div>
        </div>
      </div>
      <div class="fpropos">
        <div class="f-title">
          <h4>A propos de cette <span>Formation</span></h4>
        </div>
        <p id="description"></p>

        <div class="fnotes">
          <span>Notez la formation</span>
          <div class="rating-star" id="rating-star">
            <i class="bi bi-star" id="star" onclick="starPosition(1)"></i>
            <i class="bi bi-star" id="star" onclick="starPosition(2)"></i>
            <i class="bi bi-star" id="star" onclick="starPosition(3)"></i>
            <i class="bi bi-star" id="star" onclick="starPosition(4)"></i>
            <i class="bi bi-star" id="star" onclick="starPosition(5)"></i>
          </div>
          <button
            type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#exampleModal"
            onclick="listerNotes()"
            id="comment-button"
          >
            Voir notes
          </button>
        </div>
      </div>
      <div class="fcommentaire">
        <h4>Commentaires</h4>
        <hr />
        <div class="comments-button d-flex justify-content-between">
          <button
            type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#staticBackdrop"
            id="comment-button"
          >
            Commenter
          </button>
          <button
            type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#exampleModal"
            onclick="listerCommentaire()"
            id="comment-button"
          >
            Liste commentaires
          </button>
        </div>
      </div>
    </div>
    <!-- popup -->
    <!-- Modal -->
    <div
      class="modal fade"
      id="staticBackdrop"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" id="cadre">
        <div class="modal-content">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
          <div class="pcommentaire px-3">
            <h4 class="text-center">Formulaire Commentaire</h4>
            <hr />
            <div class="mb-3">
              <label for="nom" class="form-label" id="label">Nom</label>
              <input type="email" class="form-control" id="nom" />
            </div>
            <div class="mb-3">
              <label for="message" class="form-labe" id="label">Message</label>
              <textarea class="form-control" id="message" rows="3"></textarea>
            </div>
            <div class="text-center">
              <button onclick="ajoutCommentaire()">Envoyer</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- popop liste commentaires -->
    <!-- Button trigger modal -->

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>

          <div class="pcommentaire px-3" id="display-comments">
            <!-- <h4 class="text-center">Liste Commentaire</h4>
            <hr /> -->
          </div>
        </div>
      </div>
    </div>

    <!-- popup notes  -->

    <!-- ========== Start footer ========== -->
    <footer id="footer">
      <div class="footer-item">
        <a class="navbar-brand" href="#"
          ><img src="../header_footer/assets/logo.png" alt=""
        /></a>
        <div class="social-link">
          <i class="bi bi-facebook"></i>
          <i class="bi bi-linkedin"></i>
          <i class="bi bi-youtube"></i>
          <i class="bi bi-github"></i>
        </div>
      </div>
      <div class="footer-item">
        <h4>Navigation</h4>
        <a href=""><i class="bi bi-link"></i> Accueil</a>
        <a href=""><i class="bi bi-link"></i> Formations</a>
        <a href=""><i class="bi bi-link"></i> Articles</a>
        <a href=""><i class="bi bi-link"></i> Politiques</a>
        <a href=""><i class="bi bi-link"></i> Condition</a>
      </div>
      <div class="footer-item">
        <h4>Services</h4>
        <a href=""><i class="bi bi-link"></i> Création site</a>
        <a href=""><i class="bi bi-link"></i> Services d'hébergement</a>
        <a href=""><i class="bi bi-link"></i> Accompagnement digitale</a>
        <a href=""><i class="bi bi-link"></i> Création d'application WEB</a>
        <a href=""><i class="bi bi-link"></i> Condition d'utlisation</a>
      </div>
      <div class="footer-item">
        <h4>Formations</h4>
        <a href=""><i class="bi bi-link"></i> Gestion de projet</a>
        <a href=""><i class="bi bi-link"></i> Design et art graphique</a>
        <a href=""><i class="bi bi-link"></i> Programmation</a>
        <a href=""><i class="bi bi-link"></i> CMS</a>
      </div>
      <div class="footer-item">
        <h4>Restez informés</h4>
        <span>S'incrire à la newsletter</span>
        <input type="text" placeholder="Email" />
        <button>S'incrire</button>
      </div>
    </footer>
    <!-- ========== End footer ========== -->
  </body>
  <!-- sweet alerts  -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- le fichier formation.js qui contient le tableau  d'object et la logique -->
  <script src="formation.js"></script>
  <!-- le script qui gère une formation  -->
  <script>
    // affichage des informations de la formation
    let formation_title = document.getElementById("formation-title");
    let formation = JSON.parse(localStorage.getItem("formationSelected"));
    formation_title.innerHTML = formation.titre;

    // affichage des videos de la formation
    let allvideos = document.getElementById("allvideos");
    // console.log(formation.videos)
    for (let i = 0; i < formation.videos.length; i++) {
      allvideos.innerHTML += `
                    <div class="video" id="${formation.videos[i].id}" onclick="displayMe(${formation.videos[i].id})">
                        <img src="https://www.vid-marketing.com/wp-content/uploads/2017/05/youtube-logo2.jpg" alt="">
                        <span id="titre">${formation.videos[i].titre}</span>
                    </div>
        `;
    }
    // affichage de la description de la formation
    let description = document.getElementById("description");
    description.innerHTML = formation.description;

    // la fonction qui lance la video sur laquelle on a cliqué
    let screenDisplay = document.getElementById("displayvideo");
    function displayMe(id) {
      for (let i = 0; i < formation.videos.length; i++) {
        if (formation.videos[i].id == id) {
          screenDisplay.innerHTML = formation.videos[i].contenu;
        }
      }
    }

    // la video active
    let activevideo = document.querySelectorAll(".video");
    activevideo.forEach((element) => {
      element.addEventListener("click", () => {
        activevideo.forEach((elem) => {
          elem.classList.remove("activevideo");
        });

        element.classList.add("activevideo");
      });
    });

    // la fonction qui ajoute les commentaires dans le localStorage
    let nom = document.getElementById("nom");
    let message = document.getElementById("message");

    let tabTmp = []; //le tableau temporaire pour eviter l'écrasement du localStorage
    function ajoutCommentaire() {
      if (nom.value != "" && message.value != "") {
        let commentaire = {
          id_formation: formation.id,
          nom: nom.value,
          message: message.value,
        };
        formation.commentaires.push(commentaire);
        if (localStorage.getItem("commentaire") !== null) {

          tabTmp = JSON.parse(localStorage.getItem("commentaire"));
          tabTmp.push(commentaire);
          localStorage.setItem("commentaire", JSON.stringify(tabTmp));
          nom.value = "";
          message.value = "";
          Swal.fire({
            icon: "success",
            title: "au revoir",
            text: "commentaire envoyé avec succès",
          });
        }
      } else {
        Swal.fire({
          icon: "error",
          title: "Oops...",
          text: "le commentaire ne peut pas etre vide",
        });
      }
    }

    // la fonction qui affiche les commentaires de la formation
    let display_comments = document.getElementById("display-comments");
    function listerCommentaire() {
      display_comments.innerHTML =
        ' <h4 class="text-center">Liste Commentaire</h4><hr/>';
      if (localStorage.getItem("commentaire") !== null) {
        let allcomments = JSON.parse(localStorage.getItem("commentaire"));
        allcomments.forEach((element) => {
          if (element.id_formation == formation.id) {
            console.log(element.nom, element.message);
            display_comments.innerHTML += ` <div class="commentaire">
                  <span>${element.nom}</span>
                  <p>${element.message}</p>
                </div>
                `;
          }
        });
      }
    }

    // le script qui gère le système d'etoile
    // let rating_star = document.getElementById("rating-star");
    let stars = document.querySelectorAll("#star");
    let notesTmp = []; //le tableau temporaire des notes, pour eviter l'écrasement des notes du localStorage
    // la fonction qui ajoute les notes dans le local storage
    function starPosition(id) {
      let note = {
        id_formation: formation.id,
        note: id,
      };
      if (localStorage.getItem("notes") !== null) {
        notesTmp = JSON.parse(localStorage.getItem("notes"));
        notesTmp.push(note);
        localStorage.setItem("notes", JSON.stringify(notesTmp));
      }
      stars.forEach((star) => {
        star.setAttribute("class", "bi bi-star");
      });
      // alert('etoile '+id+" cliquée");
      for (let i = 0; i < id; i++) {
        stars[i].setAttribute("class", "bi bi-star-fill");
      }
    }

    // la fonction qui affiche les notes de la formation
    // let display_comments = document.getElementById("display-comments");
    function listerNotes() {
      display_comments.innerHTML =
        ' <h4 class="text-center">Liste Notes</h4><hr/>';
      if (localStorage.getItem("notes") !== null) {
        let allnotes = JSON.parse(localStorage.getItem("notes"));
        // console.log(allnotes)
        allnotes.forEach((element) => {
          if (element.id_formation == formation.id) {
            // console.log(element.nom, element.message);
            // console.log(element)
            display_comments.innerHTML += ` <div class="note">
                  <p> ${element.note} <span>étoiles</span></p>
                  
                </div>
                `;
          }
        });
      }
    }
  </script>
</html>
